(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{453:function(s,t,a){"use strict";a.r(t);var n=a(14),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("在编写单元测试时，如何保证所有代码都能够被测试到呢？之前介绍的设计测试用例的方法可以基本保证主流程的测试，但依然存在人为的疏忽和一些边界情况可能漏测的问题。代码覆盖率是衡量测试是否严谨的指标，检查代码覆盖率可以帮助单元测试查漏补缺。")]),s._v(" "),t("h2",{attrs:{id:"代码覆盖率"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#代码覆盖率"}},[s._v("#")]),s._v(" 代码覆盖率")]),s._v(" "),t("p",[t("code",[s._v("Istanbul")]),s._v("是JavaScript中十分常用的代码覆盖率检查工具，其提供的"),t("code",[s._v("npm")]),s._v("包叫"),t("code",[s._v("nyc")]),s._v("，可以使用下面的命令安装nyc")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npm install --save-dev nyc\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后修改一些"),t("code",[s._v("package.json")]),s._v("文件中的"),t("code",[s._v("scripts")]),s._v("字段，在"),t("code",[s._v("mocha")]),s._v("前面加上"),t("code",[s._v("nyc")]),s._v("，通过"),t("code",[s._v("nyc")]),s._v("来执行"),t("code",[s._v("mocha")]),s._v("命令即可获得代码覆盖率：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"test"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nyc mocha"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("再次执行"),t("code",[s._v("npm test")]),s._v("命令，在原来的测试结果最下面会增加代码覆盖率的检查结果。\n"),t("img",{attrs:{src:"https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/20230321213113.png",alt:""}})]),s._v(" "),t("p",[t("code",[s._v("Istanbul")]),s._v("支持从以下4个维度来衡量代码覆盖率，需要注意语句和行的区别，由于一行中可能有多条语句，因此语句覆盖率信息更精确")]),s._v(" "),t("ul",[t("li",[s._v("语句覆盖率（Statement Coverage）")]),s._v(" "),t("li",[s._v("分支覆盖率（Branch Coverage）")]),s._v(" "),t("li",[s._v("函数覆盖率（Function Coverage）")]),s._v(" "),t("li",[s._v("行覆盖率 (Line Coverage)")])]),s._v(" "),t("p",[s._v("控制台的输出中会报告4种覆盖率，同时会报告没有被覆盖到的行号，这个信息一般能够帮助到漏测的逻辑。此外，Istanbul支持输出多种格式的报告。")]),s._v(" "),t("p",[s._v("在项目根目录下新建一个.nycrc文件：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"reporter"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"html"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("text就是我们在控制台中看到的输出，html会生成一个可以通过浏览器查看的页面。")]),s._v(" "),t("p",[s._v("重新执行"),t("code",[s._v("npm test")]),s._v("命令，会在根目录生成一个coverage目录，打开coverage/index.js.html文件就可以看到生成的报告了。\n"),t("img",{attrs:{src:"https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/20230321213845.png",alt:""}})])])}),[],!1,null,null,null);t.default=e.exports}}]);